---
phase: 06-cli-interface
plan: 06
type: execute
wave: 3
depends_on: []
files_modified: [src/cli/mod.rs]
autonomous: true

must_haves:
  truths:
    - "mirage status shows database statistics"
    - "status command already implemented - just verify completeness"
  artifacts:
    - path: "src/cli/mod.rs"
      provides: "Verified status() command handler is complete"
      min_lines: 40
  key_links:
    - from: "src/cli/mod.rs::status()"
      to: "src/storage/mod.rs::MirageDb::status"
      via: "direct function call"
      pattern: "db\\.status\\(\\)"
---

<objective>
Verify the status() command implementation is complete and follows all patterns correctly. This command was implemented in Phase 1 and should already be functional.

**Purpose:** Confirm the status command works correctly and all output formats are supported.

**Output:** Verified working `mirage status` command.
</objective>

<execution_context>
@/home/feanor/.claude/get-shit-done/workflows/execute-plan.md
@/home/feanor/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-cli-interface/06-RESEARCH.md
@src/cli/mod.rs
@src/storage/mod.rs
@.planning/phases/01-database-foundation/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Verify status() command implementation is complete</name>
  <files>src/cli/mod.rs</files>
  <action>
  Review the existing status() command in src/cli/mod.rs:

  1. Verify signature follows pattern: `status(_args: StatusArgs, cli: &Cli)`

  2. Verify database connection with proper error handling:
     - Uses `resolve_db_path(cli.db.clone())`
     - Opens database with `MirageDb::open()`
     - Handles errors with helpful hint message

  3. Verify all three output formats are handled:
     - OutputFormat::Human: Prints human-readable status
     - OutputFormat::Json: Uses JsonResponse::new(data).to_json()
     - OutputFormat::Pretty: Uses JsonResponse::new(data).to_pretty_json()

  4. Verify DatabaseStatus struct is used correctly:
     - Queries cfg_blocks, cfg_edges, cfg_paths, cfg_dominators counts
     - Includes mirage_schema_version and magellan_schema_version

  5. If any issues are found, fix them. If everything is correct, add a comment verifying the implementation is complete.

  No new code should be needed - this is a verification task.
  </action>
  <verify>
  Run `cargo build` to verify compilation.
  Run `mirage status --output human` to verify human output.
  Run `mirage status --output json` to verify JSON output.
  Run `mirage status --output pretty` to verify pretty JSON output.
  </verify>
  <done>
  The status() command is verified complete:
  - All three output formats work correctly
  - Error handling provides helpful hints
  - Database statistics are accurate
  - Follows Magellan's JsonResponse wrapper pattern
  </done>
</task>

<task type="auto">
  <name>Add any missing tests for status command</name>
  <files>src/cli/mod.rs</files>
  <action>
  In the `#[cfg(test)] mod tests` section, verify or add:

  1. Test for human output format
  2. Test for JSON output format (valid JSON structure)
  3. Test for pretty JSON output format
  4. Test for database open error handling

  If these tests already exist, verify they pass. If any are missing, add them.
  </action>
  <verify>
  Run `cargo test` to verify all tests pass.
  </verify>
  <done>
  Tests cover the status() command behavior for all scenarios.
  </done>
</task>

</tasks>

<verification>
Overall phase checks:
- [ ] `cargo build` succeeds with no warnings
- [ ] `cargo test` passes all tests
- [ ] status() command outputs all database statistics
- [ ] All three output formats (human/json/pretty) work correctly
- [ ] Error handling provides helpful hints
- [ ] JsonResponse wrapper is used for JSON outputs
</verification>

<success_criteria>
1. `mirage status` shows database statistics in human-readable format
2. `mirage status --output json` outputs valid JSON
3. `mirage status --output pretty` outputs formatted JSON
4. Database not found shows helpful error message
</success_criteria>

<output>
After completion, create `.planning/phases/06-cli-interface/06-06-SUMMARY.md`
</output>
